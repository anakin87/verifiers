# AGENTS / CLAUDE Compilation Design

## Problem

The repository currently uses a single root `AGENTS.md` as both:

1. Contributor guidance for this repo.
2. Downloaded guidance for end users (`prime lab setup` / `vf-setup`).

That coupling makes edits noisy and mixes audiences.

## Goals

- Separate **source-of-truth content** for:
  - shared best practices,
  - repo-only guidance,
  - end-user lab guidance.
- Compile outputs for both audiences without duplicating text.
- Move setup-downloaded AGENTS/CLAUDE sources under `assets/lab/`.
- Keep environment guide generation (`environments/AGENTS.md`) in the same compile flow.

## Proposed Source Layout

```
assets/agents/
├── common_best_practices.md
├── repo_development_best_practices.md
├── end_user_best_practices.md
└── compilation_design.md
```

## Compiled Outputs

Generated by the repository sync tooling:

- `AGENTS.md` = common + repo development sections.
- `CLAUDE.md` = repo-oriented pointer to `AGENTS.md`.
- `assets/lab/AGENTS.md` = common + end-user sections.
- `assets/lab/CLAUDE.md` = end-user pointer to workspace AGENTS files.
- `environments/AGENTS.md` and `assets/lab/environments/AGENTS.md` = built from `docs/environments.md`.

## Portability Note

Files under `assets/` are intended to be copied into lab workspaces.
They should not rely on repository-local script paths or suggest a fixed provenance location.

## Setup Integration

`verifiers/scripts/setup.py` should download AGENTS/CLAUDE files from `assets/lab/` so the setup path consumes end-user docs only.

## Initial Implementation Scope

- Add modular docs stubs for shared/repo/end-user guidance.
- Replace sync script with a compiler-style generator for all targets.
- Update setup downloader URLs to `assets/lab/...`.
- Keep generated root files for repo contributors.

## Future Extensions

- Add section-level metadata (ordering, include conditions).
- Add CI check to enforce generated files are up to date.
- Optionally generate additional assistant-specific pointers (e.g., Cursor/Gemini).
